---
layout: default
title: Layers: Air and Heat
excerpt_separator: <!--more-->
---

Layers
======

### What?

This is a concept for both architecture and gameplay. The idea is very simple: that different subsystems live on different layers "under" the play surface. In this blog I'll write about two of the layers, what they're for, how they work from the player's perspective and how they're implemented. One interesting point is that for the player they're two(+) layers but in the code it's only one layer with two(+) systems running side-by-side.

### Gameplay - Air Layer

It's hard for agents to breathe if there isn't any air. Not being able to breathe, at least in the simulation that I'm planning, will prove harmful if not fatal. So maintaining a supply of correctly pressurized air going to be pretty important to keep the spacecraft habitable. Air flows everywhere except where it's blocked by hull plates or closed hatches. If you want to expand the ship first you have to enclose an area with hull and then let air flow into it. 

The very basic square test "ship" that you'll see in following screenshots is just a series of walls or hull plates. Right now "air" is just a single thing, so really it's pressure. Eventually I'll separate it into different gasses: at least CO2 and O2 and maybe some nasty toxics. Adding more gasses is not a hard thing to implement.

The player will have to manage pressure, probably usually low pressure, with the use of pumps, airlocks, doors and of course hull plates. Air will also be able to move through conduits (a layer for a later blog), be stored in pressurized containers and generated by certain items.

### Gameplay - Heat Layer

We always think of space as a very cold place and it is in some sense. A vacuum is, however, also an incredibly good insulator. There are three ways that heat moves around, convection: little bits of stuff carrying heat with them to other places, conduction: heat moving though bigger bits of stuff, and radiation: little bits of heat moving all by themselves. The vacuum of space only allows one out of three of those things, radiation. This means that a metal tube surrounded by vacuum does not let heat go easily. Heat generated by, say using machines or being alive will mostly just stay in the spacecraft and build up. On the other hand, if the spacecraft isn't generating much internal heat it will eventually radiate away all the heat and cool to space's ambient temperature which is, as I said in the start, very cold.

When machines or people get too hot or too cold they cease to function well and eventually at all. It's important to keep the temperature in a nice range for not dying purposes. The gameplay implications for this are that heat will have to be actively managed, moved around, generated and/or disposed of. Heat will be created by certain (probably most) objects, moved by pumps and conduits and radiated into space.

### Implementation Details

Heat and air are pretty different from a gameplay perspective but their implementations are very similar. The spacecraft is divided up into a grid of cells and each of those cells has a pressure value and a temperature value. Each cell also has a flag that says whether it's a wall or not. The spread of both heat and air is essentially a blurring function. Each square has 8 neighbours and every iteration the total amount of air or heat is totaled and split between all 9 squares. There are some differences in the way that walls are handled between air and heat: walls are simply not processed for air and neighbouring walls are neither counted nor distributed to. 

Heat handling is a bit more complicated and, honestly, I'm not done refining (fixing) how it works so it seems reasonable. 
